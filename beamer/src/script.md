# 开始
各位评审老师好，我是16级专硕一班的学生 王泽涛，导师是林伟伟教授。

我的论文题目是《基于容器的负载预测模型与能耗优化调度策略研究》，下面我将向各位老师汇报我的论文，恳请各位老师批评指导。

# 目录
我论文的主要结构可概括为4个部分，分别是：研究动机、趋势感知容器负载预测模型、基于动态伸缩容器调度策略以及总结和展望

# 转场1
在第一部分内容，"研究动机"中，我将介绍问题背景，以及论文中提出的两个研究目标：容器的负载监控和容器的能耗优化调度

# 1.研究动机
## 1.1 问题背景
### p4-1
首先来看问题背景

虚拟化是实现云计算发展的核心技术，目前主流的虚拟化技术为：虚拟机和容器。它们两者的区别如图1所示：
- 虚拟机通过在主机操作系统之上引入Hypervisor来实现同一台物理服务运行多个操作系统实例，特点在于：
    1. 每个虚拟机得到独立的模拟出的硬件设备
    2. 每个虚拟机必须安装自己的操作系统（Guest OS）
- 容器技术则无需模拟硬件或者为每个实例安装独立操作系统，特点在于：
    1. 它利用内核的Namespace特性为每个容器创建独立的命名空间，使之无法感知外部进程的存在，从而实现运行环境隔离
    2. 它利用内核的CGroups特性对分配给容器的资源加以控制，并设置相应的上限，确保不会因为单个容器占用太多资源而导致系统整体陷入瘫痪

### p4-2
容器的出现推动了云计算运行模式的转变，从原先以虚拟机为核心的IaaS PaaS和SaaS转变到以容器为核心的CaaS，可称为容器即服务。

如图2所示，在CaaS架构中，容器并不像图1的传统模式一样直接运行在宿主操作系统上，取而代之的是运行在虚拟机内。
其原因在于：
虽然从上述比较可知，容器的实现更加轻量化，能够极大简化云服务从开发、测试到部署上线的整个流程，但却存在安全性和资源
的问题（这两点在生产环境受重视程度更高），通过用虚拟机对主机资源进行先行一步的隔离可以在享受容器优势同时有效解决这两个问题，
而且根据VMware和IBM的研究，CaaS模式下容器运行性能相比传统部署模式损耗很低。

### p4-3
虽然CaaS模式日益普及进一步扩大了云计算的规模，但这也会造成云数据中心的能耗问题日益严重。而能耗优化和"绿色计算"却是在云计算领域不断
倡导的一个课题。

### p5
因此针对以上的问题背景，我们提出了如下研究目标：解决CaaS模式下云数据中心的能耗优化问题。并且，我们将这一目标拆分成两小点：
1. 由于容器的负载与能耗紧密相关，很多调度决策都必须依赖负载数据，因此，我们首先需要建立实时、准确和易扩展的负载监控机制
2. 要在1的基础上设计一种容器调度策略，在保证云服务质量（QoS）的同时有效降低数据中心整体能耗

## 1.2 负载监控
### p6-1
容器负载监控机制对云数据中心资源配置和调度决策有较大影响，现有的监控机制主要有两种：
1是基于负载采集程序，如图3所示，但会因为负载变化频繁和网络异构问题导致数据滞后，所以它不满足我们提出的第一个目标

### p6-2
另一种方式则是通过数学模型来预测容器的负载，这种方式不仅能满足我们的目标需求，而且预测模型能支持我们去主动进行资源配置和容器调度
而不是被动的，根据采集程序知道过载已经发生了才去调整。

### p7-1
由于我们确定了使用负载预测模型来解决目标1（建立负载监控机制），因此现在问题变为何种类型的预测模型更适合云计算场景下的"容器负载预测"

现有的模型主要有两大类：单值预测模型和区间预测模型，我们先看第一种"单值预测模型"。根据文献调研的结果，如下表所示，我们发现单值预测
模型的本质为：根据负载历史数据来预测未来某一时刻负载的特定值，因此这种模型普遍存在着2个缺陷：
1. 误差敏感导致决策失效
2. 鲁棒性差导致决策过度
我们可以通过一张图说明这些问题

### p7-2
图中，横坐标代表时间，纵坐标代表负载，蓝色和绿色线分别代表不同容器的负载，红色线代表负载阈值，规定当容器负载上升到高于负载阈值
时需要扩容，反之，若下降到低于负载阈值缩容，其他时刻不变。

单值预测模型的结果存在误差，而在t1时刻，蓝色容器预测误差的扰动刚好又在红色阈值附近，决策器错误地相信了预测结果，进行了扩容，因而
造成了由于**误差敏感导致决策失效**

再看绿色容器，虽然它在t1, t2时刻的预测误差没有造成决策失效，但是由于负载频繁波动，根据我们既定的规则，决策器必须先在t1时刻缩容，又在t2时刻
扩容，因而造成了由于**鲁棒性差导致决策过度**。从绿色容器整体来看，其负载大部分时间处于红色阈值之上，没必要因为局部负载回落影响频繁决策，这样
会产生额外开销。

### p7-3
我们再来看一下另一类模型 —— 区间预测模型。根据文献调研的结果，如下表所示，区间预测的概率轮模型与机器学习模型的区别在于，前置是根据
样本的分布假设和统计特征（均值和标准差）来扩展区间的（就是在均值上加减置信度为$\alpha$的偏度信息），后者则是先对单值进行预测，然后再
在这基础上加减先验假设的偏度信息。从本质上来看，当前的区间预测模型必须先对目标分布进行假设，然后再依据假设将结果扩展为预测区间，从而更
有效地向决策器描述因误差和负载扰动产生的不确定性。

我们同样可以通过一张图来说明区间预测模型在解决决策失效和决策过度上的能力

### p7-4
通过区间预测模型，蓝色容器在t1时刻的预测结果变成了区间（如蓝色虚线所示），虽然区间的上界因为误差依然跑到了红色阈值上方，但可以看到
由于区间下界到红色阈值的宽度要大于上界到阈值的宽度，根据区间假设说明负载有更大概率落在下半区域，因此决策器不会进行扩容，从而解决了
因误差敏感导致的决策失效。

再来看绿色容器在t1，t2时刻的预测区间，我们可以发现，虽然负载在频繁波动，但是区间上半区域始终大于下半部分，根据区间假设说明负载有更大
概率落在过载的这一部分，因从决策器不会进行缩容，从而解决了因鲁棒性差导致的决策过度。

但由于当前的区间预测模型在预测前都必须先对目标分布特征作出一个假设，而这种先验假设的准确性很难保证，因此模型预测效果容易存在较大波动。
更进一步，即使采用了较为合理的先验假设，但由于在实际生产中，容器间甚至同一容器不同时间段的负载类型存在差异，因此在模型中使用固定不变
的分布假设甚至会对预测结果产生不利的影响。

综上，关于对区间预测模型的改进以及本文提出的趋势感知的区间预测模型将在第二部分内容中介绍

## 1.3 容器调度
### p8-1
之前，云计算中调度策略的研究主要集中在任务调度和虚拟机调度上。虽然从算法角度看，容器调度与任务调度、虚拟机调度都可归结为一种近似装箱
问题，但从实际应用角度看，它们三者还是存在较大区别，因此不能将调度任务和虚拟机的方法直接复用到容器上。

我们先来看容器调度与任务调度区别。
1. 生命周期。任务往往有完成时间的限制，而容器没有，因此任务调度需要考虑任务完成的效率
2. 状态管理。为了实现高并发，容器化应用在运行中不需要对状态数据进行管理，而任务，如Hadoop中计算任务需要对结果进行汇总，因此任务
调度需要考虑状态管理
3. 动态调整。同个应用往往有多个容器副本，而副本数量是可以根据需求调整的。但任务数量在任务提交后一般是不可变的

### p8-2
我们再来看容器调度与虚拟机调度区别
1. 资源隔离。虚拟机是通过硬件模拟方式"分割"资源，而容器则是通过系统内核的Namespace、CGroups等软限制方式"分享"资源，分享就意味着
容器间是可以进行资源借贷的
2. 迁移开销和延迟。虚拟机迁移不仅涉及大量文件拷贝，而且虚拟机启停时间较长（分钟级，容器是毫秒级的），因此在调度中需要非常谨慎对待迁移。
3. 调度粒度。相较于虚拟机，容器可以做到进程级的调度
4. 依赖距离。为了方便，可以将相互依赖的服务放到同一台虚拟机上，但容器不行，容器一般是单进程的，因此容器调度有时需要考虑因依赖距离产生
网络开销问题。

综上，设计基于容器的能耗优化调度策略是一项非常重要的研究，关于本文提出的基于动态伸缩的容器调度策略将在第三部分内容中介绍。

# 转场2
在第二部分内容中，我将分5点介绍"趋势感知容器负载预测模型"。首先介绍模型的总体结构，然后分步讲解模型实施的三个过程：趋势感知、区间构造
和区间预测，最后将对实验结果进行分析。

# 2.趋势感知容器负载预测模型
## 2.1 模型结构
### p10(引言)
在第一部分内容中，我们先分析单值预测模型两个缺点：误差敏感和鲁棒性差，以及它们对资源配置决策的影响，为此，我们随后又引出了可以用
区间预测模型来避免这两个缺点，因为预测区间能包含目标不确定性，更适合于决策，但不足的是，目前学术界的区间预测模型必须依赖于先验假设
并且不能适应不同的负载类型。

为此，我在论文中提出了基于趋势感知区间预测模型，它的特点是：
1. 能够感知负载趋势，并能将负载分为平稳型、趋势型和周期型三类。模型名称中的SAC即表示该过程
2. 区间构造，在预测前会先基于负载类型将历史负载的单值序列转化为区间序列
3. 区间预测，预测过程建立在区间构造之上，因此最后能直接输出预测区间，不需要作任何先验假设。模型名称中的GPSO-SVM即表示该过程
4. 实时预测，模型训练完成之后，在一段时期内模型是保持不变，它可以根据系统不断反馈的实时负载数据向前预测未来负载的波动区间。

这里的预测效率有两层含义：
1. 模型根据历史数据进行训练的效率，即模型从无到有的时间
2. 模型训练完成后，每次预测时的计算效率

### p11(示意图)
我们可以结合图5、图6来直观了解模型实施过程。
1. 最开始容器的负载数据是单值序列
2. 根据本文提出的SAC规则，将负载分成平稳型、趋势型和周期型三类
3. 针对不同负载类型，采用不同区间构造方法，将原先单值序列转变成区间序列
4. 开始预测前，需要选择滑动窗口，此处设窗口大小为3
5. 根据滑动窗口大小，我们对训练集的上/下界序列进行重新采样，将t时刻的负载数据作为标签y，将t-3, t-2, t-1负载数据组合成特征向量
6. 根据重新采样后得到的训练数据，基于SVM方法，可以得到上界模型和下界模型。
7. 当然训练过程中涉及到的SVM超参优化，就交给引入梯度信息的粒子群算法（GPSO）解决
8. 新的模型在一段时期内是保持不变的（黄色区域）,这段模型有效期长短可由人为设定
9. 之后它可以根据系统不断反馈的实时负载数据向前预测未来负载的波动区间。

介绍完模型的整体结构后，我将对模型中三个重要过程：趋势感知、区间构造和区间预测进行详细说明

## 2.2 趋势感知
### p12(定义)
首先，我们来看趋势感知。

由于实际应用中，很难获得瞬时CPU利用率同时监控软件精度存在差异，所以我们定义容器的负载为，时间段p内CPU利用率的均值，如公式1所示

根据不同的采样频率$t_i - t_{i-1}$，我们可以获得一组负载时序数据，其中{照着念}

### p13(SAC规则)
解释完定义后，我们来看趋势感知中的核心算法——SAC规则

SAC规则指的是基于频谱特征分析和自相关系数分析的综合检验规则，实施过程如图7所示。

接下来，我将分别介绍这两种分析方法。

### p14(SAC - 频谱特征分析)
SAC规则中的第一部分——"频谱特征分析"是用来判定负载是否存在周期性的，具体过程如下：
1. 通过离散傅立叶变化，将属于时域的负载数据转变为属于频域的负载信号，如公式4所示。
2. 通过公式5，6将不同频率下的负载信号转变成频谱特征序列

### p15(SAC - 频谱特征分析)
如图8我们可以看到，原本的负载数据（红色线）是每个时间点对应一个负载实际值，而经过频域和特征转换后，现在是每个频率
对应一个频谱特征值，或者称为能量。

对于一个具有周期性的负载数据来说，属于它的周期性分量（浅蓝色线）会在频域上形成一个个峰值（深蓝色线），峰值越高说明原数据
在这一频率下的周期性特征越明显。因此，我们可以通过检查是否存在这些"峰值"来判定负载是否具有周期性，并获得它的周期频率

### p15(SAC - 自相关系数分析)
如果负载不具有周期性，那么我们就需要通过自相关系数分析来判断它是平稳的还是有趋势的，具体过程如下：
1. 按照滞后期k将原序列拆分成前置序列和后置序列，后置序列中每个对应值都要比前置序列领先k个时间点
2. 计算滞后期为k时，前后序列的自相关系数，如公式7所示
3. 通过设定不同的k值并重复过程1,2，我们可以获得一组自相关系数序列

对于平稳性负载来说，它的自相关系数序列在一定置信水平上是与0值显著相关的，我们可以通过显著性检验来进行判断

### p17(SAC - 判定)
我们对周期性的判定是通过奇异值检验方法，来检查频谱特征序列是否存在"峰值"，具体过程如下：
1. 按照公式9将频谱特征序列Q转化为差分序列H
2. 计算H的均值和标准差
3. 根据3sigma准则，{照着念}

我们对平稳性的显著性检验则是通过t-检验来完成的，一般设定显著性水平为0.05，然后计算负载的自相关系数序列与0值显著相关的概率

### p18(SAC - 判定)
这里我们对SAC判定规则进行了总结

## 2.3 区间构造
### p19
当我们根据SAC规则对负载进行分类后，下一步，我们需要针对不同类型的负载构造区间，将原先的单值序列转变成区间序列

平稳型负载区间构造较为简单，其上界是每一项与序列最大值的平均，下界是每一项与序列最小值的平均

### p20-21
对于趋势型负载，首先需要计算差分项的均值，我称之为活动空间，它代表总体上，序列上升或者下降的平均空间

然后，我们结合活动空间，根据负载序列总体是上升的还是下降的来构建区间

### p22-24
对于周期型负载，我则是将序列分为前、中、后三段分别计算活动空间，然后，在每一项加上或减去对应区段的活动空间来获得上下界

## 2.4 区间预测
### p25-26
有了区间构造后的负载历史数据的区间序列，并选定滑动窗口的值，我们就可以开始进行模型训练了

由于SVM方法有两个超参数，对于我们既要训练上界SVM模型又要训练下界SVM模型来说是4个超参数，因此，为了获得较好的模型，
我们在正式训练开始前，需要先对超参数进行优化。

论文中选定的优化器是带梯度信息的粒子群算法，原因是它的全局搜素能力强，并且有了梯度信息后，算法收敛速度有了提升。

1. 首先通过5折交叉验证，将训练数据进行分为trainBag和testBag
2. 然后计算粒子的适应度和梯度信息，其中适应度函数CWC（区间覆盖标准将在之后介绍）
3. 通过不断地更新局部域和全局域，最终获得近似最优的SVM超参数

### p27
在超参数优化中提到的适应度函数——区间覆盖度标准CWC，是用来检验预测区间好坏的一个通用指标

它由两部分组成，一是预测区间覆盖率PICP，如公式11所示，表示的是真值落到区间内概率，该值越到，说明区间准确的越高，但并不能
但看这个值就决定区间好坏，比如，对于负载来说，它的值一定在0～100内波动，如果我们输出的区间刚好是0～100，虽然PICP的值=1
准确度百分百，但是这样的区间是没有任何价值的

为此，CWC的另一部分预测区级归一化平均宽度PINEW，就是来限制区间宽度的，如公式12所示，PINEW越小说明区间宽度越小，区间对决策的帮助也就越大

为了综合判定预测区间优劣，CWC将二者结合了起来，公式13中eta代表标准的偏好，eta越到PICP越重要，反之PINEW越重要。而mu则表示结果的置信度

### p28
回归到实际过程，有了SVM超参数优化的结果，我们再将完整的训练集带入到模型训练过程后，最终可以获得上/下界模型，并输出预测区间

## 2.5 实验结果与分析
### p29
为了验证模型的预测效果与预测效率，论文使用了PlanetLab 2011.3.3-2011.4.20内11746个容器负载数据设计了4组实验。

实验1，为了直观展示SAC-GPSO-SVM模型的预测效果，通过SAC算法选出了3种最能代表平稳型、趋势型和周期型负载数据来进行预测，如图9所示
每份容器数据都记录了每日每5分钟内的CPU利用率的均值，共287个点。实验将前200个点作为训练集，后87个点作为测试集。

SAC-GPSO-SVM模型对这三个容器的预测结果如图10～12所示，可以发现除了部分突发情况，模型输出的预测区间能够以一个较小的宽度覆盖大部分真值，
并且区间上下界都保留了真实负载的波动特性

### p30
论文选择了朴素贝叶斯、线性回归、普通SVM、分类回归树和随机森林作为对比算法。

朴素贝叶斯模型的预测结果如图13所示，可以看到对于平稳型负载，它预测区间的下界对真值覆盖率较差，但对趋势型和周期型负载覆盖结果较好

### p31
如图14-15，线性回归和SVM模型存在同样的问题

### p32
如图16-17，分类回归树和随机森林模型输出的预测区间对平稳型和趋势型覆盖率较好，但不适应对周期型负载的预测

### p33
为了从整体上更进一步的验证预测效果，实验2分别用6种模型对全部1万多个容器的负载进行了预测，结果如下：

实验表明，SAC-GPSO-SVM模型可以在保证区间覆盖率较高的情况下，输出更窄的预测区间。从整体上看，相较于其他5种算法
本文模型能在负载类型异构的情况下，给出CWC最佳的预测结果。

### p34
因为考虑到部分模型需要进行超参数优化才能达到最佳预测效果，因此，为了更科学对比各模型的预测效率，实验3将剔除参数优化时间，直接
比较最优参数下，模型的平均预测时间。实验结果如图18所示。

随机森林模型为了获得较高准确率需要构建很多的树(表1中，它的覆盖率最高)，因此时间复杂度明显高于其他模型。从剩余模型的预测时间对比
可以看出，SAC-GPSO-SVM模型不会因为预测效果提升而大幅增加时间复杂度。

### p35
虽然，实验3检验了模型理论上预测效率，但在实际生产环境中，为了获得一段预测期内一个固定的模型，会涉及到建立模型时最耗时的阶段——超参数优化。
为了验证本文参数优化方法GPSO既能保证优化效果，又能满足实时性要求（预测期之间的模型重构时间不能太长），设计了实验4，将主流的参数优化方法
网格搜索、随机搜素、传统PSO与本文GPSO进行对比，结果如表2所示

实验结果表明，GPSO算法收敛的时间最短，同时CWC指标仅次于全局搜索（网格搜索）的结果。它23.34秒的平均预测时间，满足实时性要求。因为
系统反馈负载间隔是5分钟，预测期之间的模型重构能在下一次预测前完成。

# 专场3
在第三部分内容中，我将分4点介绍"基于动态伸缩的容器调度策略"。首先介绍系统的整体结构，然后是对CaaS模式下容器能耗优化问题的定义，
接着会阐明具体的调度算法，最后将对实验结果进行分析。

# 3.基于动态伸缩的容器调度策略
## 3.1 系统结构
### p37(调度系统模型)
我们在介绍第一部分内容——研究动机时阐明了CaaS模式的架构特征，这一模式存在着如下特征和问题：
1. 同一个应用会对应多个容器副本，副本数量应该是动态可变的
2. 外部请求量增加，如果副本数量不足，会导致容器过载，此时需要增加副本数来分流请求，从而保证SLA（服务等级协议）
3. 在2之后，如果外部请求量减小，那么副本数量冗余导致容器欠载，此时需要减少副本数量，并把配套的虚拟机、已激活服务器数量也减少，
从而避免不必要的能耗

针对以上问题，论文提出了如下的解决方案：
1. 调度模型通过预测容器负载，进行主动资源调整，比如扩容或者缩容，而不是等过载/欠载发生了才去做，这一点已经由第三部分完成
2. 调度模型根据预测结果和调整阈值，就给出定量的扩缩容数量，具体的扩缩容算法将在之后介绍
3. 容器在伸缩调整后，调度模型会重新迁移、放置和合并容器，进而能关闭一些无容器运行的虚拟机或者服务器，从而降低能耗，具体策略将在之后介绍。

### p38(调度系统示意图)
根据上述解决方案，论文具体给出了图19所示的调度系统示意图

该系统由3部分组成：主机状态模块、容器状态模块和容器调度模块

主机状态模块根据具体规则检测出当前的高负载主机和低负载主机。

容器状态模块会根据负载预测情况控制扩缩容，其中的容器选择器不仅会从高负载主机列表选择需要迁移的容器还负责选择需要删除的缩容副本。
新增容器和其他需要迁移的容器会最终形成容器迁移列表，发送到过载迁移目标选择器。

位于容器调度模块的过载迁移目标选择器会从候选主机中找出迁移目的地，如果当前不存在这样的地方，则会要求虚拟机构建器开辟新的空间。

欠载迁移目标选择器则负责合并低负载主机上容器，如果在合并完后，虚拟机、主机空载则会执行销毁和休眠

VM-Host迁移管理器会执行最终的迁移工作。

介绍完了调度系统的架构，下面就将介绍部分模块使用到的一些具体算法

## 问题定义
### p39(CaaS架构能耗模型)
我们首先来看定义的优化目标

在仅考虑服务器能耗前提下，CaaS数据中心t时刻的能耗$P_dc(t)$为全部服务器能耗的和

服务器i的能耗计算，论文采用CPU能耗模型方式。

而服务器的CPU利用率则是它上面全体容器的CPU利用率之和

### p40
我们的优化目标是，满足资源限制情况下，最小化总体能耗

### p41
由于单纯从降低多少能耗角度衡量算法优劣是不科学的，因此论文提出了如下服务质量指标：

将SLA违反率定义为未满足的CPU量占请求量的百分比

由于容器对CPU的请求量很难直接获取，因此我们定义了一个超量因子，直接从它的CPU历史数据中获得该值

## 调度算法
### p42
论文采用固定阈值法来对检测主机状态是过载还是欠载

并提出了基于皮尔森系数的负载相关度分析，作为后续容器选择和主机选择算法的基础

容器负载和主机负载越相关，说明该容器对主机负载贡献度越大，也就越会引起主机的过载

### p43-44
容器伸缩算法给出了如何定量计算容器扩缩容数量的方法

论文将预测得到的一个应用所有容器副本的负载上界和下界加起来，形成应用总体负载上/下界

如果满足公式21，说明大部分负载真值在阈值之上，扩容，反之缩容
{翻页}

扩容数量和缩容数量如公式23，24所示。

公式24中的减1，保证缩容会至少保留一个副本

### p45-46
容器选择算法有两部分责任，第一：从高负载主机列表中选择需迁移容器，即选择与主机负载相关度最好的容器
{翻页}

第二：选择因缩容需要删除的容器，即依据CPU利用率删除大部分时间处于idle状态的副本

### p47-48
容器的迁移、放置和合并过程都依赖于 主机选择算法来选择容器目的地

它的核心思路是，负载相似度低说明容器不会引起主机过载，迁移过程成立

如果在一轮迭代中找不到目的地，则会放松相似度判定阈值

### p49
有了主机选择算法，容器的迁移和放置则是不断遍历候选主机找到目的地，目的地不存在则创建新的空间

### p50-51
而容器的合并则会稍微复杂一点，它会用一个临时列表存储欠载主机上每个容器合并的目的地
若经过检验，合并成立，则开始执行，并且会要求休眠空载主机

## 实验结果与分析
### p52
实验采用的PlanetLab的容器负载数据，并通过CloudSim来做仿真

本文选择2种工业界常用的容器迁移算法FFHS LFHS和学术界基于启发式的WEEC

为了使实验更加科学，论文按照会影响调度效果的三个阈值设置了三组对照组

### p53-55
综上，实验结果说明，本文提出的基于动态伸缩的容器调度策略，能在保证SLA违反率低于5%(工业界需要对消费者进行补偿的SLA界限)
{翻页56}





